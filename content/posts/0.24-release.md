---
title: "Pyodide 0.24.0 release"
date: 2023-09-11
tags: ["release", "announcement"]
author: "Hood Chatham on behalf of the Pyodide team"
showToc: true
TocOpen: false
hidemeta: false
comments: false
# description: ""
disableHLJS: true # to disable highlightjs
disableShare: false
hideSummary: false
searchHidden: true
ShowReadingTime: true
ShowBreadCrumbs: true
ShowPostNavLinks: true
---

Pyodide 0.24 is a major release focused on fine tuning public APIs and
performance improvements. It includes a major rework of the streams APIs to be
faster and more flexible. We also improved the consistence of APIs and made
fixes for many strange edge cases in the foreign function interface. 

## Performance Improvements

Up to this point, we had not devoted much energy to performance improvements so
there was a lot of low hanging fruit.

### Loading performance

We finally added a `packages` argument to `loadPyodide` so that packages can be
downloaded during the Pyodide bootstrap. We also fixed the loading problem where
`pyodide.asm.wasm` is only downloaded after `pyodide.asm.js` is finished loading
which can improve the load time by as much as a second. There is a lot more work
to do in improving load time but both of these changes are significant
improvements.

### Foreign Function Interface performance

Several major bottlenecks were identified: rendering our debug messages for
`PyProxy` use-after-free errors turned out to take a huge amount of run time. we
pregenerate the strings and interning the results, and by only enabling the more
expensive debug support if `pyodide.setDebug(true)` is run first. we also avoid
registering the PyProxy object arguments to a JavaScript function called from
Python if they are destroyed eagerly, since registering and unregistering these
from the garbage collector is expensive.

The other major performance problem was the hiwire map. By changing the data
structures involved we managed to improve the performance of `to_js` by a factor
of 15 on a 10kb json object.

## Streams Rework

The internal implementation of the `pyodide.setStdxxx` APIs were completely
reworked to make them faster and to allow correct handling of keyboard
interrupts and `O_NONBLOCK` / `EAGAIN`. We also added a new way of implementing
standard streams by defining a `read` function for `stdin` or a `write` function
for stdout/stderr. These are the simplest APIs to implement internally, and the
older APIs are implemented in terms of them. In some cases sometimes they are
also the simplest to use, but these cases were previously forced to
inefficiently convert through one of the other options.

## micropip improvements

We've made some useful improvements to micropip.

1. micropip now supports the Simple Repository API (PEP 503, PEP 691), which is a
standard way of querying packages to the Python package repository. We also added
supports for using package repositorys other than PyPI via
`micropip.install(index_urls="...")` or `micropip.set_index_urls()`.
This means that you can host and use a collection of WASM Python packages that you have built
in your local environment,
using [pyodide build](https://pyodide.org/en/stable/development/building-and-testing-packages.html).

2. It is now possible to delete packages at runtime using `micropip.uninstall`.
This allows you to uninstall and reinstall packages when you install a package and
find that the version is incorrect and breaks dependencies.

3. Added `verbose` option to `micropip.install`.
Previously, micropip was totally silent and it was hard to tell
what packages were being installed, but now when installing packages
from PyPI or other index URLs, pip-like installation messages are printed to stdout
so you can see what packages are being installed.

## What's next

* Recently clang and Emscripten have added much better support for `externref`.
  Using `externref`s will allow further performance improvements and a
  significant reduction in code size.
* Chrome is going to have origin trials for JavaScript Promise Integration in
  the next few months. Once available in browser engines, the JSPI should solve
  many of our I/O woes. We have already done a lot of work on JSPI support for
  Pyodide and are hoping to include a mature implementation in the next release.
* Cibuildwheel support and a PEP for Emscripten wheels on PyPI support.
* More work on load time and ffi performance.


## Acknowledgements

Thanks to everyone who contributed code to this release and all users who
reported issues and provided feedback. Thanks to the PyScript and Jupyterlite
developers and community for their feedback and contributions. Particularly, we
would like to thank Andrea Giammarchi, Antonio Cuni, Chris Laffner, and Der
Thorsten. Thanks to Brett Cannon and Mark Shannon for core Python support.

Thanks to the Emscripten team for their helpful and responsive support. 

The following people commited to Pyodide in this release:

Adam Tombleson, Alexey Ignatiev, Andrea Giammarchi, Angus Hollands, Arpit, Bart
Broere, Christian Clauss, chrysn, David Lechner, Deepak Cherian, Eli Lamb,
Feodor Fitsner, Guillaume Lemaitre, Gyeongjae Choi, Hannes Krumbiegel, Hanno
Rein, Henry Schreiner, Hood Chatham, Ian Thomas, Jeff Glass, Jo Bovy, Joe
Marshall, Joseph Rocca, Juniper Tyree, Kai Tietz, Kevin Hill, Loïc Estève, Luiz
Irber, Maks Bialas, Martin Renou, Martoxa, messense, Michael Weinold, Milan Raj,
nascheinkman, Neil Stoker, Nicholas Bollweg, Owen Lamont, Roman Yurchak, Tamás
Nepusz, TheOnlyWayUp, Tim Paine, Tim Sherratt, Tomas R, Tom Nicholas, Victor
Blomqvist, Yan Wong, Ye Joo Park, Yossi Shirizli, कारतोफ्फेलस्क्रिप्ट

